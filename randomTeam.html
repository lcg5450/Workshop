<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í¼í”Œì›ìŠ¤ í€´ì¦ˆí€´ì¦ˆ íŒ€ í¸ì„±ê¸°</title>
    <link rel="stylesheet" type="text/css" href="./styles.css" />
</head>
<body>
    <div class="container">
        <h1>ğŸ¯ í¼í”Œì›ìŠ¤ í€´ì¦ˆí€´ì¦ˆ íŒ€ í¸ì„±ê¸°</h1>
        
        <div class="input-section">
            <label for="members-input">íŒ€ì› ì´ë¦„ì„ ìˆ˜ì •í•˜ê±°ë‚˜ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•˜ì„¸ìš” (ì‰¼í‘œë¡œ êµ¬ë¶„)</label><br/>
            <textarea id="members-input">ì •í¬ì„±, ì„œë³‘ë§Œ, ì„œì€ì›, ì´ìƒí˜¸, ê°•ë™í›ˆ, ê¶Œì˜¤ê·œ, ê¹€ë¯¼ì„œ, ê¹€ì‚¼ì—°, ê¹€ìŠ¹ë¦¬, ë°•ê²½ì¤€, ì„±ëˆ„ë¦¬, ì˜¤ê·œìš©, ì´ì°½ê·€, ì´í˜„ë¡œ, ì´í™”ì¤‘, ì •ì°½ìš±, ì •í˜„ì„, ìµœì¬ì›, ë°•ì •í˜„, ì‹ í˜œë€, ì´ê·œí˜¸, ì´ìŠ¹ì›, í™ìŠ¹ê· , í•œì˜ìˆ˜, ê°•ë‹¤ì¸, ìœ¤ì¢…ì›, ì´ìš©í•´, ì •ê²½í™˜</textarea>
            
            <div class="button-group">
                <button onclick="generateTeams()" id="team-btn">íŒ€ í¸ì„±í•˜ê¸°</button>
                <button onclick="regenerateTeams()" id="regen-btn" disabled>ë‹¤ì‹œ í¸ì„±</button>
            </div>
        </div>
        
        <div class="area-title">íŒ€ì› ëª©ë¡</div>
        <div class="members-display-area" id="members-display-area">
            <!-- ë©¤ë²„ë“¤ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
        </div>
        
        <div class="area-title" style="margin-top: 30px;">íŒ€ í¸ì„± ê²°ê³¼</div>
        <div class="team-formation-area" id="team-formation-area">
            <div class="initial-message" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">
                íŒ€ í¸ì„± í›„ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤
            </div>
        </div>
        
        <div class="team-info" id="team-info">
            <h3 style="text-align: center; margin-bottom: 20px;">íŒ€ í¸ì„± ìƒì„¸</h3>
            <div class="team-summary" id="team-summary"></div>
        </div>
    </div>

    <script>
        let currentMembers = [];
        let memberElements = [];
        let currentTeams = [];
        let inputTimeout;

        // íŒ€ ìƒ‰ìƒ ë°°ì—´
        const teamColors = [
            '#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7',
            '#DDA0DD', '#98D8C8', '#F7DC6F', '#BB8FCE', '#85C1E9'
        ];

        // Fisher-Yates ì„ê¸° ì•Œê³ ë¦¬ì¦˜
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        // íŒ€ í¸ì„± í•¨ìˆ˜
        function createRandomTeams(members, minSize = 4, maxSize = 5) {
            if (members.length < minSize) {
                return [members];
            }
            
            const shuffledMembers = [...members];
            shuffleArray(shuffledMembers);
            
            const teams = [];
            let remainingMembers = [...shuffledMembers];
            
            while (remainingMembers.length > 0) {
                if (remainingMembers.length <= maxSize) {
                    if (remainingMembers.length >= minSize) {
                        teams.push(remainingMembers);
                    } else {
                        if (teams.length > 0) {
                            teams[teams.length - 1].push(...remainingMembers);
                        } else {
                            teams.push(remainingMembers);
                        }
                    }
                    break;
                }
                
                const remainingCount = remainingMembers.length;
                let teamSize;
                
                if (remainingCount % maxSize === 0) {
                    teamSize = maxSize;
                } else if (remainingCount % minSize === 0) {
                    teamSize = minSize;
                } else {
                    const remainderWithMax = remainingCount % maxSize;
                    teamSize = (remainderWithMax === 0 || remainderWithMax >= minSize) ? maxSize : minSize;
                }
                
                const currentTeam = remainingMembers.slice(0, teamSize);
                teams.push(currentTeam);
                remainingMembers = remainingMembers.slice(teamSize);
            }
            
            return teams;
        }

        // ë©¤ë²„ í‘œì‹œ í•¨ìˆ˜
        function showMembers() {
            const input = document.getElementById('members-input').value.trim();
            const newMembers = input ? input.split(',').map(name => name.trim()).filter(name => name) : [];
            
            // ê¸°ì¡´ ë©¤ë²„ì™€ ê°™ì€ì§€ í™•ì¸
            if (JSON.stringify(newMembers) === JSON.stringify(currentMembers)) {
                return;
            }
            
            currentMembers = newMembers;
            const displayArea = document.getElementById('members-display-area');
            
            // ê¸°ì¡´ ë©¤ë²„ë“¤ ì œê±°
            memberElements.forEach(el => {
                el.style.opacity = '0';
                el.style.transform = 'scale(0)';
                setTimeout(() => el.remove(), 300);
            });
            memberElements = [];
            
            if (currentMembers.length === 0) {
                document.getElementById('team-btn').disabled = true;
                document.getElementById('regen-btn').disabled = true;
                return;
            }
            
            if (currentMembers.length < 2) {
                document.getElementById('team-btn').disabled = true;
                document.getElementById('regen-btn').disabled = true;
                return;
            }
            
            // ìƒˆ ë©¤ë²„ë“¤ ìƒì„±
            currentMembers.forEach((member, index) => {
                const circle = document.createElement('div');
                circle.className = 'member-circle floating';
                circle.textContent = member;
                circle.style.backgroundColor = teamColors[index % teamColors.length];
                circle.dataset.originalIndex = index;
                circle.dataset.memberName = member;
                
                displayArea.appendChild(circle);
                memberElements.push(circle);
                
                // ì•½ê°„ì˜ ì§€ì—°ì„ ë‘ê³  ë‚˜íƒ€ë‚˜ëŠ” íš¨ê³¼
                setTimeout(() => {
                    circle.classList.add('show');
                }, index * 100);
            });
            
            document.getElementById('team-btn').disabled = false;
            
            // íŒ€ í¸ì„±ì´ ì´ë¯¸ ë˜ì–´ìˆë‹¤ë©´ ë¦¬ì…‹
            if (currentTeams.length > 0) {
                document.getElementById('regen-btn').disabled = true;
                document.getElementById('team-info').classList.remove('show');
                currentTeams = [];
                
                // íŒ€ í¸ì„± ì˜ì—­ ì´ˆê¸°í™”
                const formationArea = document.getElementById('team-formation-area');
                document.querySelectorAll('.team-container').forEach(container => container.remove());
                
                if (!formationArea.querySelector('.initial-message')) {
                    formationArea.innerHTML = `
                        <div class="initial-message" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">
                            íŒ€ í¸ì„± í›„ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤
                        </div>
                    `;
                }
            }
        }

        // textarea ë³€ê²½ ê°ì§€
        document.getElementById('members-input').addEventListener('input', function() {
            clearTimeout(inputTimeout);
            inputTimeout = setTimeout(() => {
                showMembers();
            }, 300); // 300ms ë”œë ˆì´ë¡œ ë„ˆë¬´ ìì£¼ ì—…ë°ì´íŠ¸ë˜ëŠ” ê²ƒì„ ë°©ì§€
        });

        // íŒ€ ìœ„ì¹˜ ê³„ì‚°
        function calculateTeamPositions(teams) {
            const formationArea = document.getElementById('team-formation-area');
            const areaRect = formationArea.getBoundingClientRect();
            const teamPositions = [];
            
            const cols = Math.ceil(Math.sqrt(teams.length));
            const rows = Math.ceil(teams.length / cols);
            
            teams.forEach((team, index) => {
                const col = index % cols;
                const row = Math.floor(index / cols);
                
                const centerX = (areaRect.width / cols) * (col + 0.5) - 30;
                const centerY = (areaRect.height / rows) * (row + 0.5) - 30;
                
                const teamMembers = team.length;
                const radius = Math.max(40, teamMembers * 15);
                
                const memberPositions = team.map((_, memberIndex) => {
                    if (teamMembers === 1) {
                        return { x: centerX, y: centerY };
                    }
                    
                    const angle = (2 * Math.PI * memberIndex) / teamMembers;
                    return {
                        x: centerX + Math.cos(angle) * radius,
                        y: centerY + Math.sin(angle) * radius
                    };
                });
                
                teamPositions.push({
                    center: { x: centerX + 30, y: centerY + 30 },
                    members: memberPositions,
                    radius: radius + 50
                });
            });
            
            return teamPositions;
        }

        // ì›ì†Œì˜ í˜„ì¬ ìœ„ì¹˜ ê³„ì‚°
        function getCurrentPosition(element) {
            const rect = element.getBoundingClientRect();
            const containerRect = element.offsetParent ? element.offsetParent.getBoundingClientRect() : document.body.getBoundingClientRect();
            return {
                x: rect.left - containerRect.left,
                y: rect.top - containerRect.top
            };
        }

        // íŒ€ í¸ì„± ì‹¤í–‰
        function generateTeams() {
            if (currentMembers.length === 0) {
                alert('íŒ€ì›ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                return;
            }
            
            if (currentMembers.length < 2) {
                alert('ìµœì†Œ 2ëª… ì´ìƒì˜ íŒ€ì›ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                return;
            }
            
            currentTeams = createRandomTeams(currentMembers);
            const teamPositions = calculateTeamPositions(currentTeams);
            const formationArea = document.getElementById('team-formation-area');
            const displayArea = document.getElementById('members-display-area');
            
            // ì´ˆê¸° ë©”ì‹œì§€ ì œê±°
            const initialMessage = formationArea.querySelector('.initial-message');
            if (initialMessage) {
                initialMessage.remove();
            }
            
            // ê¸°ì¡´ íŒ€ ì»¨í…Œì´ë„ˆ ì œê±°
            document.querySelectorAll('.team-container').forEach(container => container.remove());
            
            // ê° ë©¤ë²„ì˜ í˜„ì¬ ìœ„ì¹˜ë¥¼ ê¸°ë¡
            memberElements.forEach(element => {
                const currentPos = getCurrentPosition(element);
                element.style.position = 'absolute';
                element.style.left = currentPos.x + 'px';
                element.style.top = currentPos.y + 'px';
                element.classList.remove('floating');
                element.classList.add('moving');
                formationArea.appendChild(element);
            });
            
            // ì•½ê°„ì˜ ë”œë ˆì´ í›„ ê° íŒ€ë³„ë¡œ ì²˜ë¦¬
            setTimeout(() => {
                currentTeams.forEach((team, teamIndex) => {
                    const teamColor = teamColors[teamIndex % teamColors.length];
                    const positions = teamPositions[teamIndex];
                    
                    // íŒ€ ì»¨í…Œì´ë„ˆ ìƒì„±
                    const teamContainer = document.createElement('div');
                    teamContainer.className = 'team-container';
                    teamContainer.style.left = (positions.center.x - positions.radius/2) + 'px';
                    teamContainer.style.top = (positions.center.y - positions.radius/2) + 'px';
                    teamContainer.style.width = positions.radius + 'px';
                    teamContainer.style.height = positions.radius + 'px';
                    teamContainer.style.borderColor = teamColor;
                    
                    const teamLabel = document.createElement('div');
                    teamLabel.className = 'team-label';
                    teamLabel.textContent = `íŒ€ ${teamIndex + 1}`;
                    teamLabel.style.color = teamColor;
                    teamContainer.appendChild(teamLabel);
                    
                    formationArea.appendChild(teamContainer);
                    
                    // íŒ€ ë©¤ë²„ë“¤ì„ í•´ë‹¹ ìœ„ì¹˜ë¡œ ì´ë™
                    team.forEach((memberName, memberIndex) => {
                        const memberElement = memberElements.find(el => el.dataset.memberName === memberName);
                        if (memberElement) {
                            memberElement.style.backgroundColor = teamColor;
                            
                            setTimeout(() => {
                                memberElement.style.left = positions.members[memberIndex].x + 'px';
                                memberElement.style.top = positions.members[memberIndex].y + 'px';
                            }, teamIndex * 100 + memberIndex * 50);
                        }
                    });
                    
                    // íŒ€ ì»¨í…Œì´ë„ˆì™€ ë¼ë²¨ í‘œì‹œ
                    setTimeout(() => {
                        teamContainer.style.opacity = '1';
                        teamLabel.style.opacity = '1';
                    }, teamIndex * 200 + 800);
                });
                
                // íŒ€ ì •ë³´ í‘œì‹œ
                setTimeout(() => {
                    displayTeamInfo(currentTeams);
                    document.getElementById('regen-btn').disabled = false;
                }, 2000);
            }, 100);
        }

        // íŒ€ ì •ë³´ í‘œì‹œ
        function displayTeamInfo(teams) {
            const teamSummary = document.getElementById('team-summary');
            teamSummary.innerHTML = '';
            
            teams.forEach((team, index) => {
                const teamCard = document.createElement('div');
                teamCard.className = 'team-card';
                teamCard.style.borderLeft = `5px solid ${teamColors[index % teamColors.length]}`;
                
                teamCard.innerHTML = `
                    <h4>íŒ€ ${index + 1} (${team.length}ëª…)</h4>
                    <ul>
                        ${team.map(member => `<li>â€¢ ${member}</li>`).join('')}
                    </ul>
                `;
                
                teamSummary.appendChild(teamCard);
            });
            
            document.getElementById('team-info').classList.add('show');
        }

        // ë‹¤ì‹œ í¸ì„±
        function regenerateTeams() {
            if (currentMembers.length === 0) return;
            
            // ë©¤ë²„ë“¤ì„ ë‹¤ì‹œ ìœ„ìª½ ì˜ì—­ìœ¼ë¡œ ì´ë™
            const displayArea = document.getElementById('members-display-area');
            const formationArea = document.getElementById('team-formation-area');
            
            // íŒ€ ì»¨í…Œì´ë„ˆë“¤ ì œê±°
            document.querySelectorAll('.team-container').forEach(container => container.remove());
            document.getElementById('team-info').classList.remove('show');
            
            // ì´ˆê¸° ë©”ì‹œì§€ ë‹¤ì‹œ ì¶”ê°€
            formationArea.innerHTML = `
                <div class="initial-message" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">
                    íŒ€ í¸ì„± í›„ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤
                </div>
            `;
            
            // ë©¤ë²„ë“¤ì„ ë‹¤ì‹œ ìœ„ìª½ìœ¼ë¡œ ì´ë™
            memberElements.forEach((element, index) => {
                element.classList.remove('moving', 'positioned');
                element.classList.add('floating');
                element.style.backgroundColor = teamColors[index % teamColors.length];
                element.style.position = 'relative';
                element.style.left = 'auto';
                element.style.top = 'auto';
                element.style.transform = 'scale(1)';
                
                displayArea.appendChild(element);
            });
            
            document.getElementById('regen-btn').disabled = true;
            
            // ì ì‹œ í›„ ìƒˆë¡œìš´ íŒ€ í¸ì„±
            setTimeout(() => {
                generateTeams();
            }, 800);
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸° ë©¤ë²„ í‘œì‹œ
        document.addEventListener('DOMContentLoaded', function() {
            showMembers();
        });
    </script>
</body>
</html>